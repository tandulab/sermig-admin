import{u as xe}from"./location39475.js";import{u as ne,e as A,s as L,f as Te}from"./helpers39475.js";import{l as G,B as te,C as de,m as ue,q as me,o as K,s as y,a as J,u as Se,c as U,i as N,_ as Q,r as m,y as ee,b as B,v as $,w as v,g as s,f as a,e as R,t as M,x as Y,h as F,z as W,A as _e,F as X,E as re}from"../index39475.js";import{c as fe,a as ge}from"./index.esm39475.js";import{F as pe}from"./vee-validate.esm39475.js";import{I as ve}from"./InputTextWithValidation39475.js";import{u as Ce}from"./category39475.js";import{d as he,e as se,a as Z,b as ie,g as ye}from"./formatData39475.js";import{D as Ee}from"./datetime39475.js";import"./attraction39475.js";import"./_commonjsHelpers39475.js";/* empty css                                                                            */class le{static async fetchAll(e){return(await G(`/admin/locations/${e}/courses`)).data}static async addCourse(e){return(await te(`/admin/locations/${e.location_id}/courses`,e)).data.course}static async updateCourse(e){return(await de(`/admin/locations/${e.location_id}/courses/${e.course.id}`,e)).data.course}static async deleteCourse(e){return await ue(`/admin/courses/${e}`)}}const we=me({id:"course",state:()=>({course:{},courses:[],response_courses:{}}),getters:{allCourses:t=>t.courses,responseCourses:t=>t.response_courses,getTotalCourses:t=>t.response_courses?t.response_courses.total:0,getCurrentCourse:t=>t.course},actions:{async fetchAllCourses(t){await le.fetchAll(t).then(e=>{this.response_courses=e,this.courses=e.courses})},async addCourse(t){await le.addCourse(t).then(e=>{this.course=e})},async updateCourse(t){await le.updateCourse(t).then(e=>{this.course=e})},async deleteCourse(t){await le.deleteCourse(t).then()}}});class ce{static async fetchAll(e){return(await G(`/admin/courses/${e}/tickets`)).data}static async addTicket(e){return await te(`/admin/courses/${e.course_id}/tickets`,e)}static async updateTicket(e){return await de(`/admin/courses/${e.course_id}/tickets/${e.ticket.id}`,e)}static async deleteTicket(e){return await ue(`/admin/courses/${e.course_id}/tickets/${e.ticket_id}`)}}const Ae=me({id:"ticket",state:()=>({ticket:{},tickets:[],response_tickets:{}}),getters:{allTickets:t=>t.tickets,responseTickets:t=>t.response_tickets,getTotalTickets:t=>t.response_tickets?t.response_tickets.total:0,getCurrentTicket:t=>t.ticket},actions:{async fetchAllTickets(t){await ce.fetchAll(t).then(e=>{this.response_tickets=e,this.tickets=e.tickets})},async addTicket(t){await ce.addTicket(t).then()},async updateTicket(t){await ce.updateTicket(t).then()},async deleteTicket(t){await ce.deleteTicket(t).then()}}}),Be={props:["course","location_id"],setup(t,e){K(()=>{t.course&&t.course.id?(n.value=Object.assign({},t.course),I()):n.value.translations={it:{name:{id:null,text:""},description:{id:null,text:""}},en:{name:{id:null,text:""},description:{id:null,text:""}}},n.value.tickets=[]});const n=y({}),o=y([]),D=y("it"),w=fe({name:ge().required("Nome percorso obbligatorio")}),{showLoader:r,hideLoader:c}=ne(),_=J(),b=we(),f=Ce(),g=Ae(),p=Se(),l=y(!1),k=U(()=>b.allCourses),V=U(()=>f.allCategories),u=U(()=>g.responseTickets),i=U(()=>b.getCurrentCourse),x=U(()=>p.languages),T=function(S){r(),b.addCourse(S).then(()=>{c(),L(_,{message:"Percorso aggiunto correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{c(),A(_,E)})},I=async function(){let S=t.course.id?t.course.id:i.value.id;r(),await g.fetchAllTickets(S).then(()=>{c()}).catch(E=>{c(),A(_,E)})},z=function(S){r(),b.updateCourse(S).then(()=>{c(),L(_,{message:"Percorso modificato correttamente",error:!1}),e.emit("onSubmit")}).catch(E=>{c(),A(_,E)})},j=function(){const S=Object.assign({},n.value);let E={it:{name:S.translations.it.name.text,description:S.translations.it.description.text},en:{name:S.translations.en.name.text,description:S.translations.en.description.text}};S.translations=E,S.name=S.translations.it.name,S.description=S.translations.it.description;const q={course:S,location_id:t.location_id};n.value.id?z(q):T(q)},O=function(){let E={translations:{en:{name:{text:"",id:null},description:{text:"",id:null}},it:{name:{text:"",id:null},description:{text:"",id:null}}},price:0};n.value.tickets.push(E),o.value.push(E)},d=function(S,E){S.id?h(S):n.value.tickets.splice(E,1)},h=async function(S){const E={course_id:t.course.id?t.course.id:i.value.id,ticket_id:S.id};r(),await g.deleteTicket(E).then(()=>{c(),L(_,{message:"Biglietto eliminato correttamente",error:!1}),I()}).catch(q=>{c(),A(_,q)})},C=function(S){let{newData:E,index:q}=S;n.value.tickets[q]=E;let De={it:{name:E.translations.it.name.text,description:E.translations.it.description.text},en:{name:E.translations.en.name.text,description:E.translations.en.description.text}};E.translations=De,E.name=E.translations.it.name,E.description=E.translations.it.description,E.id?ae(E):P(E)},P=async function(S){const E={course_id:t.course.id?t.course.id:i.value.id,ticket:S};await g.addTicket(E).then(()=>{c(),L(_,{message:"Biglietto aggiunto correttamente",error:!1}),I()}).catch(q=>{c(),A(_,q)})},ae=async function(S){const E={course_id:t.course.id?t.course.id:i.value.id,ticket:S};await g.updateTicket(E).then(()=>{c(),L(_,{message:"Biglietto aggiornato correttamente",error:!1}),I()}).catch(q=>{c(),A(_,q)})},Ve=function(S){let E={it:{name:S.translations.it.name.text,description:S.translations.it.description.text},en:{name:S.translations.en.name.text,description:S.translations.en.description.text}};S.translations=E,S.id?ae(S):P(S)};return N(V,()=>{n.value.category||(n.value.category=V.value[0])}),N(u,()=>{u.value&&u.value.tickets.length>0?n.value.tickets=Object.assign([],u.value.tickets):n.value.tickets=[]}),N(i,()=>{n.value=Object.assign({},i.value)}),{form:n,schema:w,loading:l,editingRows:o,response_tickets:u,lang_selected:D,onSubmit:j,addTicket:O,onDeleteTicket:d,onRowEditSave:C,updateTicketsApi:ae,onPublicTicket:Ve,courses:k,categories:V,languages:x}},components:{Form:pe,InputTextWithValidation:ve}},Ue={class:"col-12 flex justify-content-end m-0 p-0 align-items-center"},Ie={key:0,class:"formgrid grid mt-3"},je={class:"field col-12"},ze={class:"field col-12"},Me={for:"description"},Re={key:1,class:"flex justify-content-end mt-4 mb-3"},Le={key:0},Ne={key:0},Fe={class:"w-full"},Oe={class:"flex justify-content-center"},Pe={class:"flex align-items-center justify-content-end mt-6"};function We(t,e,n,o,D,w){const r=m("Dropdown"),c=m("InputTextWithValidation"),_=m("Textarea"),b=m("Button"),f=m("InputText"),g=m("Column"),p=m("InputSwitch"),l=m("DataTable"),k=m("Form"),V=ee("tooltip");return B(),$(k,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[s("div",Ue,[a(r,{options:o.languages,optionLabel:"name",optionValue:"value",class:"m-2 capitalize dropdown-lng",modelValue:o.lang_selected,"onUpdate:modelValue":e[0]||(e[0]=u=>o.lang_selected=u)},null,8,["options","modelValue"])]),o.lang_selected&&o.form&&o.form.translations?(B(),R("div",Ie,[s("div",je,[a(c,{name:"name",label:"Nome percorso* ("+o.lang_selected.toUpperCase()+")",modelValue:o.form.translations[o.lang_selected].name.text,"onUpdate:modelValue":e[1]||(e[1]=u=>o.form.translations[o.lang_selected].name.text=u)},null,8,["label","modelValue"])]),s("div",ze,[s("label",Me,"Descrizione ("+M(o.lang_selected.toUpperCase())+")",1),a(_,{rows:"5",cols:"30",name:"description",id:"description",label:"Nome percorso*",modelValue:o.form.translations[o.lang_selected].description.text,"onUpdate:modelValue":e[2]||(e[2]=u=>o.form.translations[o.lang_selected].description.text=u),class:"w-full"},null,8,["modelValue"])])])):Y("",!0),o.form.id?(B(),R("div",Re,[a(b,{label:"Tipologia biglietto",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[3]||(e[3]=u=>o.addTicket())})])):Y("",!0),o.form.id&&o.lang_selected?(B(),$(l,{key:2,value:o.form.tickets,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[4]||(e[4]=u=>o.editingRows=u),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:v(()=>[F(" Nessun biglietto trovato. ")]),default:v(()=>[a(g,{header:"Tipo biglietto",style:{"min-width":"150px"},field:"name"},{body:v(({data:u})=>{var i;return[u.translations[o.lang_selected].name?(B(),R("span",Le,M((i=u.translations[o.lang_selected].name)==null?void 0:i.text),1)):Y("",!0)]}),editor:v(({data:u,field:i})=>[a(f,{modelValue:u.translations[o.lang_selected][i].text,"onUpdate:modelValue":x=>u.translations[o.lang_selected][i].text=x,name:"ticket_name_"+o.lang_selected,id:"ticket_name_"+o.lang_selected,type:"text"},null,8,["modelValue","onUpdate:modelValue","name","id"])]),_:1}),a(g,{header:"Descrizione",field:"description"},{body:v(({data:u})=>{var i;return[u.translations[o.lang_selected].description?(B(),R("span",Ne,M((i=u.translations[o.lang_selected].description)==null?void 0:i.text),1)):Y("",!0)]}),editor:v(({data:u,field:i})=>[s("div",Fe,[a(_,{modelValue:u.translations[o.lang_selected][i].text,"onUpdate:modelValue":x=>u.translations[o.lang_selected][i].text=x,class:"w-full",name:"desc_"+o.lang_selected},null,8,["modelValue","onUpdate:modelValue","name"])])]),_:1}),a(g,{header:"Prezzo",field:"price",bodyStyle:"min-width: 6rem"},{body:v(({data:u})=>[F(" € "+M((+u.price).toFixed(2)),1)]),editor:v(({data:u,field:i})=>[a(f,{modelValue:u[i],"onUpdate:modelValue":x=>u[i]=x},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{header:"Stato",field:"public",bodyStyle:"min-width: 6rem"},{body:v(({data:u,field:i})=>[a(p,{modelValue:u[i],"onUpdate:modelValue":x=>u[i]=x,onChange:x=>o.onPublicTicket(u)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),editor:v(({data:u,field:i})=>[a(p,{modelValue:u[i],"onUpdate:modelValue":x=>u[i]=x},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{rowEditor:!0,bodyStyle:"text-align:center; padding-right:0;min-width: 6rem"}),a(g,{header:"",style:{width:"3rem","padding-left":"0"}},{body:v(({data:u,index:i})=>[s("div",Oe,[W(a(b,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:x=>o.onDeleteTicket(u,i)},null,8,["onClick"]),[[V,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])):Y("",!0),s("div",Pe,[a(b,{label:"Annulla",text:"",onClick:e[5]||(e[5]=u=>t.$emit("onClose"))}),a(b,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const qe=Q(Be,[["render",We]]),He={props:["location_id"],setup(t){K(()=>{w.value=!0,r.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},r.value.page=0,k()});const e=J(),n=y(),o=y(),D=y(),w=y(!0),r=y(),c=y(0),_=y(!1),{showLoader:b,hideLoader:f}=ne(),g=we(),p=U(()=>g.responseCourses),l=_e();U(()=>l.submitDialog);function k(){b(),setTimeout(()=>{V()},Math.random()*1e3+250)}const V=async function(){w.value=!0,await g.fetchAllCourses(t.location_id).then(()=>{w.value=!1,f()}).catch(z=>{w.value=!1,f(),A(e,z)})},u=function(z){D.value=z,_.value=!0},i=function(z){D.value=z;let j="Sei sicuro di voler archiviare questo percorso?";l.setDialog("Archivia percorso","Archivia","Annulla",j),l.setBtnSubmit(!1),l.setDynamicDialogVisibility(!0)},x=function(z){const j=Object.assign({},z);let O={it:{name:j.translations.it.name.text,description:j.translations.it.description.text},en:{name:j.translations.en.name.text,description:j.translations.en.description.text}};j.translations=O;const d={course:j,location_id:t.location_id};g.updateCourse(d).then(()=>{f(),L(e,{message:"Percorso modificato correttamente",error:!1}),V()}).catch(h=>{f(),A(e,h)})},T=function(){return D.value&&D.value.id?"Modifica percorso":"Aggiungi percorso"},I=function(){V(),_.value=!1};return N(t,()=>{t.location_id&&V()}),{dt:n,responseCourses:p,loading:w,totalRecords:c,lazyParams:r,op:o,visible:_,currentCourse:D,loadLazyData:k,onEditCourse:u,closeDialog:I,getHeader:T,updateCourse:x,onArchiveCourse:i}},components:{CourseDialog:qe}},Ge={class:"flex justify-content-end mt-4 mb-3"},Ke={class:"flex justify-content-center"};function Je(t,e,n,o,D,w){const r=m("Button"),c=m("Column"),_=m("InputSwitch"),b=m("DataTable"),f=m("CourseDialog"),g=m("Dialog"),p=ee("tooltip");return B(),R(X,null,[s("div",Ge,[a(r,{label:"Percorso",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=l=>o.onEditCourse({}))})]),a(b,{value:o.responseCourses.courses,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessun percorso trovato. ")]),default:v(()=>[a(c,{header:"Nome"},{body:v(({data:l})=>{var k;return[F(M((k=l.translations.it.name)==null?void 0:k.text),1)]}),_:1}),a(c,{header:"Tipologie biglietti"},{body:v(({data:l})=>[(B(!0),R(X,null,re(l.tickets,k=>{var V;return B(),R("div",{key:k.id},M((V=k.translations.it.name)==null?void 0:V.text),1)}),128))]),_:1}),a(c,{header:"Prezzo"},{body:v(({data:l})=>[(B(!0),R(X,null,re(l.tickets,k=>(B(),R("div",{key:k.id}," € "+M((+k.price).toFixed(2)),1))),128))]),_:1}),a(c,{header:"Stato"},{body:v(({data:l})=>[a(_,{modelValue:l.public,"onUpdate:modelValue":k=>l.public=k,onChange:k=>o.updateCourse(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(c,{header:""},{body:v(({data:l})=>[s("div",Ke,[W(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:k=>o.onEditCourse(l),class:"mr-2"},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(g,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"},onHide:e[4]||(e[4]=l=>o.closeDialog())},{default:v(()=>[a(f,{course:o.currentCourse,location_id:n.location_id,onOnSubmit:e[1]||(e[1]=l=>o.closeDialog()),onOnClose:e[2]||(e[2]=l=>o.closeDialog())},null,8,["course","location_id"])]),_:1},8,["visible","header"])],64)}const Qe=Q(He,[["render",Je]]);class oe{static async fetchAll(e){return e?(await G("/admin/booking_rules",e)).data:{}}static async getCourses(e){return(await G("/admin/booking_rules/courses",e)).data}static async getTickets(e){return(await G("/admin/booking_rules/tickets",e)).data}static async addConfiguration(e){return await te("/admin/booking_rules",e)}static async updateConfiguration(e){return await de(`/admin/booking_rules/${e.booking_rule.id}`,e)}static async deleteConfiguration(e){return e==null?{}:await ue(`/admin/booking_rules/${e}`)}}const be=me({id:"configuration",state:()=>({configuration:{},configurations:[],response_configurations:{},response_courses:{},response_tickets:{}}),getters:{allConfigurations:t=>t.configurations,responseConfigurations:t=>t.response_configurations,getTotalConfigurations:t=>t.response_configurations?t.response_configurations.total:0,getCurrentConfiguration:t=>t.configuration,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets},actions:{async fetchAllConfigurations(t){await oe.fetchAll(t).then(e=>{this.response_configurations=e,this.configurations=e.configurations})},async getAllCourses(t){await oe.getCourses(t).then(e=>{this.response_courses=Te(e)})},async getAllTickets(t){await oe.getTickets(t).then(e=>{this.response_tickets=e})},async addConfiguration(t){await oe.addConfiguration(t).then()},async updateConfiguration(t){await oe.updateConfiguration(t).then()},async deleteConfiguration(t){t!=null&&await oe.deleteConfiguration(t).then()}}}),Xe={props:["config","location_id","course_id","duplicate"],setup(t,e){K(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.from_date&&(n.value.from_date=he(n.value.from_date)),n.value.to_date&&(n.value.to_date=he(n.value.to_date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_rule_slots=[]),O()});const n=y({}),o=y([]),D=y(!1),w=fe({name_config:ge().required("Nome configurazione obbligatoria")}),{showLoader:r,hideLoader:c}=ne(),_=J(),b=Ce(),f=y(!1),g=be(),p=U(()=>b.allCategories),l=U(()=>g.responseTickets),k=U(()=>g.responseCourses),V=function(){r();const d=Object.assign({},n.value);d.from_date&&(d.from_date=se(d.from_date)),d.to_date&&(d.to_date=se(d.to_date)),d.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(C=>{C.available_seats!=""&&C.start_at!=""&&d.booking_rule_slots.push(C)});const h={booking_rule:d};g.addConfiguration(h).then(()=>{c(),L(_,{message:"Configurazione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(C=>{c(),A(_,C)})},u=function(){r();const d=Object.assign({},n.value);d.from_date&&(d.from_date=se(d.from_date)),d.to_date&&(d.to_date=se(d.to_date)),d.booking_rule_slots=[],n.value.booking_rule_slots&&n.value.booking_rule_slots.forEach(C=>{C.available_seats!=""&&C.start_at!=""&&d.booking_rule_slots.push(C)});const h={booking_rule:d};g.updateConfiguration(h).then(()=>{c(),L(_,{message:"Configurazione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(C=>{c(),A(_,C)})},i=function(){n.value.id?u():V()},x=function(){let d={};d.price=0,n.value.tickets.unshift(d),o.value.push(n.value.tickets[0])},T=function(d){let{newData:h,index:C}=d;n.value.booking_rule_slots[C]=h},I=function(){let d={start_at:"",available_seats:"",id:"-1"};n.value.booking_rule_slots.push(d),o.value.push(d)},z=function(d,h){n.value.booking_rule_slots.splice(h,1)},j=function(d){d?n.value.wdays=[0,1,2,3,4,5,6]:n.value.wdays=[]},O=function(){const d=new Map;d.set("location_id",n.value.location_id),d.set("course_id",n.value.course_id),g.getAllTickets(d).catch(h=>{A(_,h)})};return N(p,()=>{n.value.category||(n.value.category=p.value[0])}),{form:n,schema:w,loading:f,editingRows:o,check_all:D,onSubmit:i,addTicket:x,onRowEditSave:T,checkAll:j,deleteSlot:z,addSlot:I,fetchAllTickets:O,categories:p,responseCourses:k,responseTickets:l}},components:{Form:pe,InputTextWithValidation:ve}};const Ye={class:"formgrid grid mt-3"},Ze={class:"field col-12"},$e={class:"field flex flex-column col-6"},eo=s("label",{for:"location"},"Percorso",-1),oo={class:"field col-3"},to=s("label",{from:"date_from"},"Dal",-1),no={class:"field col-3"},io=s("label",{from:"date_to"},"Al",-1),ao={class:"field col-12 mt-3"},so=s("label",null,"Giorni",-1),lo={class:"card flex flex-wrap gap-3 mt-2"},co={class:"flex align-items-center mr-4"},ro=s("label",{for:"all",class:"ml-2"}," Tutti i giorni ",-1),uo={class:"flex align-items-center"},mo=s("label",{for:"lun",class:"ml-2"}," Lun ",-1),_o={class:"flex align-items-center"},fo=s("label",{for:"mar",class:"ml-2"}," Mar ",-1),go={class:"flex align-items-center"},po=s("label",{for:"mer",class:"ml-2"}," Mer ",-1),vo={class:"flex align-items-center"},bo=s("label",{for:"gio",class:"ml-2"}," Gio ",-1),ko={class:"flex align-items-center"},ho=s("label",{for:"ven",class:"ml-2"}," Ven ",-1),Co={class:"flex align-items-center"},yo=s("label",{for:"sab",class:"ml-2"}," Sab ",-1),xo={class:"flex align-items-center"},wo=s("label",{for:"dom",class:"ml-2"}," Dom ",-1),Vo={class:"field col-3 mt-3"},Do=s("label",null,"Biglietti",-1),To={for:"ticket.id",class:"ml-2 flex align-items-center"},So={class:"inline-block",style:{"min-width":"150px"}},Eo={class:"text-right"},Ao=s("div",{class:"col-9"},null,-1),Bo={class:"col-8 mt-3"},Uo={class:"field flex justify-content-between align-items-end mt-4 mb-3"},Io=s("label",null,"Orari",-1),jo={class:"flex justify-content-center"},zo={class:"flex align-items-center justify-content-end mt-6"};function Mo(t,e,n,o,D,w){const r=m("InputTextWithValidation"),c=m("Dropdown"),_=m("Calendar"),b=m("Checkbox"),f=m("Button"),g=m("InputMask"),p=m("Column"),l=m("InputNumber"),k=m("DataTable"),V=m("Form"),u=ee("tooltip");return B(),$(V,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[s("div",Ye,[s("div",Ze,[a(r,{name:"name_config",label:"Nome configurazione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i),id:"name_config",type:"text"},null,8,["modelValue"])]),s("div",$e,[eo,a(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>{o.form.booking_rule_ticket_ids=[],o.fetchAllTickets()})},null,8,["modelValue","options"])]),s("div",oo,[to,a(_,{inputId:"date_from",modelValue:o.form.from_date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.from_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",no,[io,a(_,{inputId:"date_to",modelValue:o.form.to_date,"onUpdate:modelValue":e[4]||(e[4]=i=>o.form.to_date=i),dateFormat:"dd/mm",placeholder:"dd/mm",panelClass:"hide-year"},null,8,["modelValue"])]),s("div",ao,[so,s("div",lo,[s("div",co,[a(b,{modelValue:o.check_all,"onUpdate:modelValue":[e[5]||(e[5]=i=>o.check_all=i),e[6]||(e[6]=i=>o.checkAll(i))],inputId:"all",name:"week",binary:!0},null,8,["modelValue"]),ro]),s("div",uo,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[7]||(e[7]=i=>o.form.wdays=i),inputId:"lun",name:"week",value:1},null,8,["modelValue"]),mo]),s("div",_o,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[8]||(e[8]=i=>o.form.wdays=i),inputId:"mar",name:"week",value:2},null,8,["modelValue"]),fo]),s("div",go,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[9]||(e[9]=i=>o.form.wdays=i),inputId:"mer",name:"week",value:3},null,8,["modelValue"]),po]),s("div",vo,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[10]||(e[10]=i=>o.form.wdays=i),inputId:"gio",name:"week",value:4},null,8,["modelValue"]),bo]),s("div",ko,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[11]||(e[11]=i=>o.form.wdays=i),inputId:"ven",name:"week",value:5},null,8,["modelValue"]),ho]),s("div",Co,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[12]||(e[12]=i=>o.form.wdays=i),inputId:"sab",name:"week",value:6},null,8,["modelValue"]),yo]),s("div",xo,[a(b,{modelValue:o.form.wdays,"onUpdate:modelValue":e[13]||(e[13]=i=>o.form.wdays=i),inputId:"dom",name:"week",value:0},null,8,["modelValue"]),wo])])]),s("div",Vo,[Do,(B(!0),R(X,null,re(o.responseTickets.tickets,i=>{var x;return B(),R("div",{key:i.id,class:"flex align-items-center mb-2 mt-2"},[a(b,{modelValue:o.form.booking_rule_ticket_ids,"onUpdate:modelValue":e[14]||(e[14]=T=>o.form.booking_rule_ticket_ids=T),inputId:i.id+"",value:i.id},null,8,["modelValue","inputId","value"]),s("label",To,[s("div",So,M((x=i.translations)==null?void 0:x.it.name.text),1),s("div",Eo,"€ "+M(i.price),1)])])}),128))]),Ao,s("div",Bo,[s("div",Uo,[Io,a(f,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[15]||(e[15]=i=>o.addSlot())})]),a(k,{value:o.form.booking_rule_slots,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[16]||(e[16]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:v(()=>[F(" Nessuno slot orario trovato. ")]),default:v(()=>[a(p,{header:"Ora",field:"start_at"},{editor:v(({data:i,field:x})=>[a(g,{id:"basic",modelValue:i[x],"onUpdate:modelValue":T=>i[x]=T,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{header:"Posti",field:"available_seats"},{editor:v(({data:i,field:x})=>[a(l,{modelValue:i[x],"onUpdate:modelValue":T=>i[x]=T,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(p,{header:"",style:{width:"3rem","padding-left":"0"}},{body:v(({data:i,index:x})=>[s("div",jo,[W(a(f,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:T=>o.deleteSlot(i,x)},null,8,["onClick"]),[[u,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])])]),s("div",zo,[a(f,{label:"Annulla",text:"",onClick:e[17]||(e[17]=i=>t.$emit("onClose"))}),a(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Ro=Q(Xe,[["render",Mo]]),Lo={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&i(t.location_id)});const e=J(),n=y(),o=y(),D=y(),w=y(),r=y(!0),c=y(),_=y(0),b=y(!1),f=y(),g=y(!1),p=be(),l=U(()=>p.responseConfigurations),k=_e(),V=U(()=>k.submitDialog),u=U(()=>p.responseCourses),i=async function(h){const C=new Map;C.set("location_id",h),await p.getAllCourses(C).then(()=>{r.value=!1}).catch(P=>{r.value=!1,A(e,P)})},x=async function(h){if(!h)return;r.value=!0;const C=new Map;C.set("location_id",t.location_id),C.set("course_id",h),await p.fetchAllConfigurations(C).then(()=>{r.value=!1}).catch(P=>{r.value=!1,A(e,P)})},T=function(h){D.value=h;let C="Sei sicuro di voler eliminare questa configurazione?";k.setDialog("Elimina configurazione","Elimina","Annulla",C),k.setBtnSubmit(!1),k.setDynamicDialogVisibility(!0)},I=async function(){D.value&&await p.deleteConfiguration(D.value).then(()=>{r.value=!1,L(e,{message:"Configurazione eliminata correttamente",error:!1}),x(f.value)}).catch(h=>{r.value=!1,A(e,h)})},z=function(h,C){w.value=h,b.value=!0,g.value=C},j=function(h){return h.map(P=>Ee.local(2022,1,2+P).setLocale("it").toFormat("ccc")).join(", ")},O=function(h){f.value=h,x(f.value),b.value=!1},d=function(){return g.value?"Duplica configurazione":w.value&&w.value.id&&!g.value?"Modifica configurazione":"Nuova configurazione"};return N(V,h=>{V.value&&I()}),N(u,()=>{u.value.courses&&u.value.courses[0]&&(f.value=u.value.courses[0].id,x(f.value))}),N(t,()=>{t.location_id&&i(t.location_id)}),{dt:n,responseConfigurations:l,loading:r,totalRecords:_,lazyParams:c,op:o,visible:b,currentConfiguration:w,responseCourses:u,course_id:f,flag_duplicate:g,fromMMDDtoDDMM:he,onDeleteConfiguration:I,confirmDelete:T,onEditConfiguration:z,fetchAllConfigurations:x,convertWdays:j,closeDialog:O,getHeader:d}},components:{ConfigurationDialog:Ro}},No={class:"flex justify-content-between mt-4 mb-3"},Fo={class:"field flex flex-column"},Oo=s("label",{for:"location"},"Percorso",-1),Po={class:"capitalize"},Wo={class:"flex justify-content-center"};function qo(t,e,n,o,D,w){const r=m("Dropdown"),c=m("Button"),_=m("Column"),b=m("DataTable"),f=m("ConfigurationDialog"),g=m("Dialog"),p=ee("tooltip");return B(),R(X,null,[s("div",No,[s("div",Fo,[Oo,a(r,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"translations.it.name.text",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllConfigurations(o.course_id))},null,8,["modelValue","options"])]),a(c,{label:"Configurazione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),a(b,{value:o.responseConfigurations.booking_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessuna configurazione trovata. ")]),default:v(()=>[a(_,{header:"Nome",field:"name"}),a(_,{header:"Dal Al"},{body:v(({data:l})=>[F(M(o.fromMMDDtoDDMM(l.from_date))+" - "+M(o.fromMMDDtoDDMM(l.to_date)),1)]),_:1}),a(_,{header:"Valida il",field:"week"},{body:v(({data:l})=>[s("div",Po,M(o.convertWdays(l.wdays)),1)]),_:1}),a(_,{header:""},{body:v(({data:l})=>[s("div",Wo,[W(a(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:k=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[p,"Duplica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:k=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:k=>o.confirmDelete(l.id)},null,8,["onClick"]),[[p,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(g,{visible:o.visible,"onUpdate:visible":e[5]||(e[5]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:v(()=>[a(f,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),onOnClose:e[4]||(e[4]=l=>o.visible=!1),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const Ho=Q(Lo,[["render",qo]]);class H{static async fetchAll(e){return e?(await G("/admin/booking_exception_rules",e)).data:{}}static async getCourses(e){return(await G("/admin/booking_exception_rules/courses",e)).data}static async getTickets(e){return(await G("/admin/booking_exception_rules/tickets",e)).data}static async addBookingException(e){return await te("/admin/booking_exception_rules",e)}static async updateBookingException(e){return await de(`/admin/booking_exception_rules/${e.booking_exception_rule.id}`,e)}static async deleteBookingException(e){return e==null?{}:await ue(`/admin/booking_exception_rules/${e}`)}static async fetchAllClosings(e){return e?(await G(`/admin/booking_exception_rules/closings?location_id=${e.get("location_id")}`)).data:{}}static async createClosing(e){return await te("/admin/booking_exception_rules/closings",e)}static async deleteClosing(e){return await te("/admin/booking_exception_rules/delete_closings",e)}}const ke=me({id:"booking_exception",state:()=>({booking_exception:{},booking_exceptions:[],response_booking_exceptions:{},response_courses:{},response_tickets:{},response_closings:{}}),getters:{allBookingExceptions:t=>t.booking_exceptions,responseBookingExceptions:t=>t.response_booking_exceptions,getTotalBookingExceptions:t=>t.response_booking_exceptions?t.response_booking_exceptions.total:0,getCurrentBookingException:t=>t.booking_exception,responseCourses:t=>t.response_courses,responseTickets:t=>t.response_tickets,responseClosings:t=>t.response_closings},actions:{async fetchAllBookingExceptions(t){await H.fetchAll(t).then(e=>{this.response_booking_exceptions=e,this.booking_exceptions=e.booking_exceptions})},async fetchAllClosings(t){await H.fetchAllClosings(t).then(e=>{this.response_closings=e})},async getAllCourses(t){await H.getCourses(t).then(e=>{this.response_courses=e})},async getAllTickets(t){await H.getTickets(t).then(e=>{this.response_tickets=e})},async addBookingException(t){await H.addBookingException(t).then()},async updateBookingException(t){await H.updateBookingException(t).then()},async deleteBookingException(t){t!=null&&await H.deleteBookingException(t).then()},async addClosing(t){await H.createClosing(t).then()},async deleteClosing(t){await H.deleteClosing(t).then()}}}),Go={props:["config","location_id","course_id","duplicate"],setup(t,e){K(()=>{t.config&&t.config.id?(n.value=Object.assign({},t.config),n.value.date&&(n.value.date=Z(n.value.date)),t.duplicate&&delete n.value.id):(n.value.location_id=t.location_id,n.value.course_id=t.course_id,n.value.booking_exception_rule_slots=[]),j()});const n=y({}),o=y([]),D=fe({name:ge().required("Nome eccezione obbligatoria")}),{showLoader:w,hideLoader:r}=ne(),c=J(),_=Ce(),b=y(!1),f=be(),g=ke(),p=U(()=>_.allCategories),l=U(()=>f.responseTickets),k=U(()=>f.responseCourses),V=function(){w();const d=Object.assign({},n.value);d.date&&(d.date=ie(d.date)),d.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(C=>{C.available_seats!=""&&C.start_at!=""&&d.booking_exception_rule_slots.push(C)});const h={booking_exception_rule:d};g.addBookingException(h).then(()=>{r(),L(c,{message:"Eccezione aggiunta correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(C=>{r(),A(c,C)})},u=function(){w();const d=Object.assign({},n.value);d.date&&(d.date=ie(d.date)),d.booking_exception_rule_slots=[],n.value.booking_exception_rule_slots&&n.value.booking_exception_rule_slots.forEach(C=>{C.available_seats!=""&&C.start_at!=""&&d.booking_exception_rule_slots.push(C)});const h={booking_exception_rule:d};g.updateBookingException(h).then(()=>{r(),L(c,{message:"Eccezione modificata correttamente",error:!1}),e.emit("onSubmit",n.value.course_id)}).catch(C=>{r(),A(c,C)})},i=function(){n.value.id?u():V()},x=function(){let d={};d.price=0,n.value.tickets.unshift(d),o.value.push(n.value.tickets[0])},T=function(d){let{newData:h,index:C}=d;n.value.booking_exception_rule_slots[C]=h},I=function(){let d={start_at:"",available_seats:"",id:"-1"};n.value.booking_exception_rule_slots.push(d),o.value.push(d)},z=function(d,h){n.value.booking_exception_rule_slots.splice(h,1)},j=function(){const d=new Map;d.set("location_id",n.value.location_id),d.set("course_id",n.value.course_id),f.getAllTickets(d).catch(h=>{A(c,h)})},O=function(){e.emit("onSubmit",n.value)};return N(p,()=>{n.value.category||(n.value.category=p.value[0])}),{form:n,schema:D,loading:b,editingRows:o,onSubmit:i,addTicket:x,onRowEditSave:T,deleteSlot:z,addSlot:I,fetchAllTickets:j,resetForm:O,categories:p,responseTickets:l,responseCourses:k}},components:{Form:pe,InputTextWithValidation:ve}},Ko={class:"formgrid grid mt-3"},Jo={class:"field col-12"},Qo={class:"field flex flex-column col-6"},Xo=s("label",{for:"location"},"Percorso",-1),Yo={class:"field col-3"},Zo=s("label",{from:"date"},"Il",-1),$o=s("div",{class:"field col-3"},null,-1),et={class:"field col-3 mt-3"},ot=s("label",null,"Biglietti",-1),tt=["for"],nt={class:"inline-block",style:{"min-width":"150px"}},it={class:"text-right"},at=s("div",{class:"col-9"},null,-1),st={class:"field col-8 mt-3"},lt={class:"field flex justify-content-between align-items-end mt-4 mb-3"},ct=s("label",null,"Orari",-1),rt={class:"flex justify-content-center"},dt={class:"flex align-items-center justify-content-end mt-6"};function ut(t,e,n,o,D,w){const r=m("InputTextWithValidation"),c=m("Dropdown"),_=m("Calendar"),b=m("Checkbox"),f=m("Button"),g=m("InputMask"),p=m("Column"),l=m("InputNumber"),k=m("DataTable"),V=m("Form"),u=ee("tooltip");return B(),$(V,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[s("div",Ko,[s("div",Jo,[a(r,{name:"name",label:"Nome eccezione*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.name=i)},null,8,["modelValue"])]),s("div",Qo,[Xo,a(c,{modelValue:o.form.course_id,"onUpdate:modelValue":e[1]||(e[1]=i=>o.form.course_id=i),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[2]||(e[2]=i=>o.fetchAllTickets())},null,8,["modelValue","options"])]),s("div",Yo,[Zo,a(_,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[3]||(e[3]=i=>o.form.date=i),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),$o,s("div",et,[ot,(B(!0),R(X,null,re(o.responseTickets.tickets,i=>{var x;return B(),R("div",{key:i.id,class:"flex align-items-center mb-2"},[a(b,{modelValue:o.form.booking_exception_rule_ticket_ids,"onUpdate:modelValue":e[4]||(e[4]=T=>o.form.booking_exception_rule_ticket_ids=T),inputId:i.id+"",name:"category",value:i.id},null,8,["modelValue","inputId","value"]),s("label",{for:i.id+"",class:"ml-2 flex align-items-center"},[s("div",nt,M((x=i.translations)==null?void 0:x.it.name.text),1),s("div",it,"€ "+M(i.price),1)],8,tt)])}),128))]),at,s("div",st,[s("div",lt,[ct,a(f,{label:"Slot orario",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[5]||(e[5]=i=>o.addSlot())})]),a(k,{value:o.form.booking_exception_rule_slots,ref:"dt",loading:o.loading,stripedRows:"",editingRows:o.editingRows,"onUpdate:editingRows":e[6]||(e[6]=i=>o.editingRows=i),editMode:"row",dataKey:"id",onRowEditSave:o.onRowEditSave},{empty:v(()=>[F(" Nessuno slot orario trovato. ")]),default:v(()=>[a(p,{header:"Ora",field:"start_at"},{editor:v(({data:i,field:x})=>[a(g,{id:"basic",modelValue:i[x],"onUpdate:modelValue":T=>i[x]=T,mask:"99:99"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{header:"Posti",field:"available_seats"},{editor:v(({data:i,field:x})=>[a(l,{modelValue:i[x],"onUpdate:modelValue":T=>i[x]=T,min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(p,{rowEditor:!0,style:{width:"8rem"},bodyStyle:"text-align:right"}),a(p,{header:"",style:{width:"3rem","padding-left":"0"}},{body:v(({data:i,index:x})=>[s("div",rt,[W(a(f,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:T=>o.deleteSlot(i,x)},null,8,["onClick"]),[[u,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","editingRows","onRowEditSave"])])]),s("div",dt,[a(f,{label:"Annulla",text:"",onClick:e[7]||(e[7]=i=>o.resetForm())}),a(f,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const mt=Q(Go,[["render",ut]]),_t={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&x(t.location_id)});const e=J(),n=y(),o=y(),D=y(),w=y(),r=y(!0),c=y(),_=y(0),b=y(!1);y([]);const f=y(),g=y(!1),p=be(),l=ke(),k=U(()=>l.responseBookingExceptions),V=_e(),u=U(()=>V.submitDialog),i=U(()=>p.responseCourses),x=async function(h){const C=new Map;C.set("location_id",h),await p.getAllCourses(C).then(()=>{r.value=!1}).catch(P=>{r.value=!1,A(e,P)})},T=async function(h){if(!h)return;r.value=!0;const C=new Map;C.set("location_id",t.location_id),C.set("course_id",h),await l.fetchAllBookingExceptions(C).then(()=>{r.value=!1}).catch(P=>{r.value=!1,A(e,P)})},I=function(h){D.value=h;let C="Sei sicuro di voler eliminare questa eccezione?";V.setDialog("Elimina eccezione","Elimina","Annulla",C),V.setBtnSubmit(!1),V.setDynamicDialogVisibility(!0)},z=async function(){D.value&&await l.deleteBookingException(D.value).then(()=>{r.value=!1,L(e,{message:"Eccezione eliminata correttamente",error:!1}),T(f.value)}).catch(h=>{r.value=!1,A(e,h)})},j=function(h,C){w.value=h,b.value=!0,g.value=C},O=function(h){f.value=h,T(h),b.value=!1},d=function(){return g.value?"Duplica eccezione":w.value&&w.value.id&&!g.value?"Modifica eccezione":"Nuova eccezione"};return N(u,h=>{h&&z()}),N(i,()=>{i.value&&i.value.courses&&i.value.courses.length>0&&(f.value=i.value.courses[0].id,T(f.value))}),N(t,()=>{t.location_id&&x(t.location_id)}),{dt:n,responseBookingExceptions:k,loading:r,totalRecords:_,lazyParams:c,op:o,visible:b,currentConfiguration:w,responseCourses:i,course_id:f,flag_duplicate:g,onDeleteConfigurationException:z,confirmDelete:I,onEditConfiguration:j,getHeader:d,closeDialog:O,fetchAllBookingExceptions:T,formatPrettyDate:Z}},components:{BookingExceptionDialog:mt}},ft={class:"flex justify-content-between mt-4 mb-3"},gt={class:"field flex flex-column"},pt=s("label",{for:"location"},"Percorso",-1),vt={class:"flex justify-content-center"};function bt(t,e,n,o,D,w){const r=m("Dropdown"),c=m("Button"),_=m("Column"),b=m("DataTable"),f=m("BookingExceptionDialog"),g=m("Dialog"),p=ee("tooltip");return B(),R(X,null,[s("div",ft,[s("div",gt,[pt,a(r,{modelValue:o.course_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o.course_id=l),options:o.responseCourses.courses,optionLabel:"name",optionValue:"id",placeholder:"",name:"location",onChange:e[1]||(e[1]=l=>o.fetchAllBookingExceptions(o.course_id))},null,8,["modelValue","options"])]),a(c,{label:"Eccezione",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[2]||(e[2]=l=>o.onEditConfiguration({},!1))})]),a(b,{value:o.responseBookingExceptions.booking_exception_rules,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessuna eccezione trovata. ")]),default:v(()=>[a(_,{header:"Nome",field:"name"}),a(_,{header:"Il"},{body:v(({data:l})=>[F(M(o.formatPrettyDate(l.date)),1)]),_:1}),a(_,{header:""},{body:v(({data:l})=>[s("div",vt,[W(a(c,{link:"",icon:"pi pi-copy",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:k=>o.onEditConfiguration(l,!0)},null,8,["onClick"]),[[p,"Duplica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:k=>o.onEditConfiguration(l,!1)},null,8,["onClick"]),[[p,"Modifica",void 0,{top:!0}]]),W(a(c,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:k=>o.confirmDelete(l.id)},null,8,["onClick"]),[[p,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(g,{visible:o.visible,"onUpdate:visible":e[4]||(e[4]=l=>o.visible=l),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:v(()=>[a(f,{config:o.currentConfiguration,onOnSubmit:e[3]||(e[3]=l=>o.closeDialog(l)),location_id:n.location_id,course_id:o.course_id,duplicate:o.flag_duplicate},null,8,["config","location_id","course_id","duplicate"])]),_:1},8,["visible","header"])],64)}const kt=Q(_t,[["render",bt]]),ht={props:["location_id","closing"],setup(t,e){K(()=>{t.closing&&t.closing.id?(n.value=Object.assign({},t.closing),n.value.date&&(n.value.date=Z(n.value.date))):n.value.location_id=t.location_id});const n=y({}),o=fe({name:ge().required("Nome chiusura obbligatoria")}),{showLoader:D,hideLoader:w}=ne(),r=J(),c=xe(),_=ke(),b=U(()=>c.allLocations),f=function(k){D(),_.addClosing(k).then(()=>{w(),L(r,{message:"Chiusura aggiunta correttamente",error:!1}),e.emit("onSubmit")}).catch(V=>{w(),A(r,V)})},g=function(k){D(),_.updateBookingException(k).then(()=>{w(),L(r,{message:"Chiusura modificata correttamente",error:!1}),e.emit("onSubmit")}).catch(V=>{w(),A(r,V)})};return{form:n,schema:o,onSubmit:function(){const k=Object.assign({},n.value);k.date&&(k.date=ie(k.date),k.location_id=t.location_id);const V={booking_exception_rule:k};n.value.id?g(V):f(V)},resetForm:function(){e.emit("onSubmit",n.value)},locations:b}},components:{Form:pe,InputTextWithValidation:ve}},Ct={class:"formgrid grid mt-3"},yt={class:"field col-6"},xt={class:"field col-6 flex flex-column"},wt=s("label",{from:"from_date"},"Il",-1),Vt={class:"flex align-items-center justify-content-end mt-6"};function Dt(t,e,n,o,D,w){const r=m("InputTextWithValidation"),c=m("Calendar"),_=m("Button"),b=m("Form");return B(),$(b,{onSubmit:o.onSubmit,"validation-schema":o.schema},{default:v(()=>[s("div",Ct,[s("div",yt,[a(r,{name:"name",label:"Nome chiusura*",modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=f=>o.form.name=f)},null,8,["modelValue"])]),s("div",xt,[wt,a(c,{inputId:"date",modelValue:o.form.date,"onUpdate:modelValue":e[1]||(e[1]=f=>o.form.date=f),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])]),s("div",Vt,[a(_,{label:"Annulla",text:"",onClick:e[2]||(e[2]=f=>o.resetForm())}),a(_,{label:"Conferma",type:"submit"})])]),_:1},8,["onSubmit","validation-schema"])}const Tt=Q(ht,[["render",Dt]]),St={props:["location_id"],setup(t){K(()=>{r.value=!0,c.value={first:0,rows:n.value.rows,sortField:null,sortOrder:null},c.value.page=0,t.location_id&&l()});const e=J(),n=y(),o=y(),D=y(),w=y(),r=y(!0),c=y(),_=y(!1),b=ke(),f=_e(),g=U(()=>f.submitDialog),p=U(()=>b.responseClosings),l=async function(){const T=new Map;T.set("location_id",t.location_id),await b.fetchAllClosings(T).then(()=>{r.value=!1}).catch(I=>{r.value=!1,A(e,I)})},k=function(T){D.value=T;let I="Sei sicuro di voler eliminare questa chiusura?";f.setDialog("Elimina chiusura","Elimina","Annulla",I),f.setBtnSubmit(!1),f.setDynamicDialogVisibility(!0)},V=async function(){if(!D.value)return;const T={location_id:t.location_id,date:D.value};await b.deleteClosing(T).then(()=>{r.value=!1,L(e,{message:"Chiusura eliminata correttamente",error:!1}),l()}).catch(I=>{r.value=!1,A(e,I)})},u=function(T){w.value=T,_.value=!0},i=function(){l(),_.value=!1},x=function(){return w.value&&w.value.id?"Modifica chiusura":"Nuova chiusura"};return N(g,T=>{g.value&&V()}),N(t,()=>{t.location_id&&l()}),{dt:n,responseClosings:p,loading:r,lazyParams:c,op:o,visible:_,currentClosing:w,formatPrettyDate:Z,onDeleteClosing:V,confirmDelete:k,onEditConfiguration:u,closeDialog:i,getHeader:x}},components:{ClosingDialog:Tt}},Et={class:"flex justify-content-end mt-4 mb-3"},At={class:"flex justify-content-center"};function Bt(t,e,n,o,D,w){const r=m("Button"),c=m("Column"),_=m("DataTable"),b=m("ClosingDialog"),f=m("Dialog"),g=ee("tooltip");return B(),R(X,null,[s("div",Et,[a(r,{label:"Chiusura",icon:"pi pi-plus",rounded:"",outlined:"",onClick:e[0]||(e[0]=p=>o.onEditConfiguration({}))})]),a(_,{value:o.responseClosings.closings,lazy:!0,paginator:!1,ref:"dt",loading:o.loading,stripedRows:""},{empty:v(()=>[F(" Nessuna chiusura trovata. ")]),default:v(()=>[a(c,{header:"Nome",field:"name"}),a(c,{header:"Il"},{body:v(({data:p})=>[F(M(o.formatPrettyDate(p.date)),1)]),_:1}),a(c,{header:""},{body:v(({data:p})=>[s("div",At,[W(a(r,{link:"",icon:"pi pi-pencil",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.onEditConfiguration(p)},null,8,["onClick"]),[[g,"Modifica",void 0,{top:!0}]]),W(a(r,{link:"",icon:"pi pi-trash",text:"",rounded:"",style:{color:"var(--surface-400)"},onClick:l=>o.confirmDelete(p.date)},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"]),a(f,{visible:o.visible,"onUpdate:visible":e[3]||(e[3]=p=>o.visible=p),modal:"",header:o.getHeader(),style:{width:"70rem"}},{default:v(()=>[a(b,{onOnSubmit:e[1]||(e[1]=p=>o.closeDialog()),onOnClose:e[2]||(e[2]=p=>o.visible=!1),location_id:n.location_id,closing:o.currentClosing},null,8,["location_id","closing"])]),_:1},8,["visible","header"])],64)}const Ut=Q(St,[["render",Bt]]),It={setup(){K(()=>{g()});const t=y({}),e=xe(),n=y(),o=y(),D=y(),{showLoader:w,hideLoader:r}=ne(),c=J(),_=y(!1),b=U(()=>e.allLocations),f=U(()=>e.getCurrentLocation),g=async function(){await e.fetchAllLocations().then(()=>{f.value&&(t.value.location=f.value,l())})},p=function(){e.updateCurrenLocation(t.value.location),l()},l=function(){o.value=Z(t.value.location.calendar_visible_from),D.value=Z(t.value.location.calendar_visible_to)},k=async function(){w();let V={calendar_visible_from:ie(o.value),calendar_visible_to:ie(D.value),location_id:t.value.location.id};await e.updateLocation(V).then(()=>{r(),L(c,{message:"Data aggiornata correttamente",error:!1}),o.value=ye(o.value),D.value=ye(D.value),_.value=!1}).catch(u=>{r(),A(c,u)})};return N(b,()=>{t.value.location_id=b.value[0].id}),{form:t,courseTable:n,calendar_visible_from:o,calendar_visible_to:D,active:_,locations:b,onChangeLocation:p,updateVisibility:k,formatPrettyDate:Z}},components:{CourseTable:Qe,OpeningsTable:Ho,BookingExceptionTable:kt,ClosingsTable:Ut}};const jt=s("h1",null,"Configurazioni",-1),zt={class:"flex align-items-center justify-content-between"},Mt={class:"field col-3 flex flex-column"},Rt=s("label",{for:"location"},"Location",-1),Lt={class:"col-9 flex justify-content-end"},Nt={class:"col-12 field"},Ft=s("label",{class:"ml-1"},"Finestra di visibilità",-1),Ot={class:"flex align-items-center mt-2 ml-0 pl-0 gap-5"};function Pt(t,e,n,o,D,w){var u;const r=m("Dropdown"),c=m("Calendar"),_=m("Inplace"),b=m("Card"),f=m("CourseTable"),g=m("TabPanel"),p=m("OpeningsTable"),l=m("BookingExceptionTable"),k=m("ClosingsTable"),V=m("TabView");return B(),R("div",null,[jt,s("div",zt,[s("div",Mt,[Rt,a(r,{modelValue:o.form.location,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.location=i),options:o.locations,optionLabel:"name",placeholder:"",name:"location",onChange:e[1]||(e[1]=i=>o.onChangeLocation())},null,8,["modelValue","options"])]),s("div",Lt,[o.form.location?(B(),$(b,{key:0,style:{width:"30rem"}},{content:v(()=>[s("div",Nt,[Ft,s("div",Ot,[a(_,{closable:!0,onClose:e[3]||(e[3]=i=>o.updateVisibility()),active:o.active},{display:v(()=>[F(" Dal: "+M(o.calendar_visible_from),1)]),content:v(()=>[a(c,{inputId:"date",modelValue:o.calendar_visible_from,"onUpdate:modelValue":e[2]||(e[2]=i=>o.calendar_visible_from=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"]),a(_,{closable:!0,onClose:e[5]||(e[5]=i=>o.updateVisibility()),active:o.active},{display:v(()=>[F(" Al: "+M(o.calendar_visible_to),1)]),content:v(()=>[a(c,{inputId:"date",modelValue:o.calendar_visible_to,"onUpdate:modelValue":e[4]||(e[4]=i=>o.calendar_visible_to=i),dateFormat:"dd/mm/yy",manualInput:!0,autofocus:""},null,8,["modelValue"])]),_:1},8,["active"])])])]),_:1})):Y("",!0)])]),(u=o.form.location)!=null&&u.id?(B(),$(V,{key:0},{default:v(()=>[a(g,{header:"Percorsi"},{default:v(()=>{var i;return[a(f,{location_id:(i=o.form.location)==null?void 0:i.id,ref:"courseTable"},null,8,["location_id"])]}),_:1}),a(g,{header:"Aperture"},{default:v(()=>[a(p,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(g,{header:"Eccezioni"},{default:v(()=>[a(l,{location_id:o.form.location.id},null,8,["location_id"])]),_:1}),a(g,{header:"Chiusure"},{default:v(()=>[a(k,{location_id:o.form.location.id},null,8,["location_id"])]),_:1})]),_:1})):Y("",!0)])}const on=Q(It,[["render",Pt]]);export{on as default};
