import{D as A,c as S}from"./formatData77657.js";import{u as I,e as V}from"./helpers77657.js";import{x as C,A as L,d as k,c as f,r as b,b as c,m as N,w as i,f as l,g as s,t as v,h as y,o as F,l as $,a as O,i as w,_ as P,e as _,p as x}from"../index77657.js";import{u as B}from"./configuration77657.js";import{u as M}from"./order77657.js";class T{static async fetchAllReveliaDashboard(e){return(await C("/admin/dashboards",e)).data}static async fetchAllDashboard(e){return(await C("/admin/dashboard",e)).data}static async initDashboard(e){return(await C(`/admin/dashboard/init?location_id=${e}`)).data}}const g=L({id:"dashboard",state:()=>({dashboard:{},dashboards:[],response_dashboards:{},courses:[]}),getters:{allDashboards:o=>o.dashboard,responseDashboards:o=>o.response_dashboards,getCurrentDashboard:o=>o.dashboard},actions:{async fetchAllReveliaDashboard(o){await T.fetchAllReveliaDashboard(o).then(e=>{this.response_dashboards=e,this.dashboard=this.response_dashboards.dashboard})},async fetchAllDashboard(o){await T.fetchAllDashboard(o).then(e=>{this.dashboard=e})},async initDashboard(o){await T.initDashboard(o).then(e=>{this.courses=e})}}}),J={class:"pl-4"},q=k({__name:"DashboardTable",props:{course:{}},setup(o){const e=o,m=g(),u=f(()=>m.allDashboards),p=f(()=>{var n;if(!((n=u.value)!=null&&n.report)||!e.course)return[];const t=u.value.report[e.course];return!t||!t.tickets?[]:Object.entries(t.tickets).map(([a,r])=>({ticketType:a,quantity:r.total_tickets??0,amount:r.total_amount??0}))}),D=f(()=>{var n,a;const t=(a=(n=u.value)==null?void 0:n.report)==null?void 0:a[e.course];return t?Number(t.total_amount??0):0}),h=f(()=>{var n,a;const t=(a=(n=u.value)==null?void 0:n.report)==null?void 0:a[e.course];return t?Number(t.total_tickets??0):0});return(t,n)=>{const a=b("Column"),r=b("DataTable");return c(),N(r,{value:p.value,tableStyle:"min-width: 30rem"},{default:i(()=>[l(a,{field:"ticketType",header:"Tipologia Biglietto",footer:"Totale:",footerClass:"font-bold text-right"}),l(a,{field:"quantity",header:"Quantità",footer:"      "+h.value,footerClass:"font-bold"},{body:i(d=>[s("div",J,v(d.data.quantity),1)]),_:1},8,["footer"]),l(a,{field:"amount",header:"Importo",footer:`€ ${Number(D.value).toFixed(2)}`,footerClass:"font-bold"},{body:i(d=>[s("span",null,"€ "+v(Number(d.data.amount).toFixed(2)),1)]),_:1},8,["footer"])]),_:1},8,["value"])}}}),R=k({__name:"DashboardPaymentsTable",setup(o){const e=g(),m=M(),u=f(()=>e.allDashboards),p=f(()=>m.paymentModeList),D=f(()=>{var t;return((t=u.value)==null?void 0:t.payments)??[]});function h(t){var a;const n=(a=p.value)==null?void 0:a.find(r=>r.id===t);return n?n.label:t}return(t,n)=>{const a=b("Column"),r=b("DataTable");return c(),N(r,{value:D.value,tableStyle:"min-width: 20rem"},{default:i(()=>[l(a,{header:"Metodo di pagamento"},{body:i(d=>[y(v(h(d.data.method)),1)]),_:1}),l(a,{field:"amount",header:"Importo"},{body:i(d=>[s("span",null,"€ "+v(Number(d.data.amount).toFixed(2)),1)]),_:1})]),_:1},8,["value"])}}}),U=k({setup(){F(()=>{o.value.from=A.now().minus({months:1}).toJSDate(),o.value.to=A.now().toJSDate();const a=JSON.parse(localStorage.getItem("location")||"null");a&&a.id&&(n(a.id),t())});const o=$({}),e=g();B();const{showLoader:m,hideLoader:u}=I(),p=O(),D=f(()=>e.allDashboards),h=f(()=>e.courses||[]),t=async function(){m();const a=new Map;a.set("from",S(o.value.from)),a.set("to",S(o.value.to)),await e.fetchAllDashboard(a).then(()=>{u()}).catch(r=>{u(),V(p,r)})},n=async function(a){await e.initDashboard(a).catch(r=>{V(p,r)})};return w(h,a=>{a.courses&&Array.isArray(a.courses)&&a.courses.length>0&&!o.value.course_name&&(o.value.course_name=a.courses[0].name)}),w(()=>o.value.from,()=>{t()}),w(()=>o.value.to,()=>{t()}),{form:o,dashboards:D,dashboardCourses:h,fetchAllDashboard:t}},components:{DashboardTable:q,DashboardPaymentsTable:R}});const E={class:"dashboard"},j=s("h1",null,"Dashboard",-1),G={key:0,class:"flex align-items-center"},Q={class:"field col-2 flex flex-column"},z=s("label",null,"Dal",-1),H={class:"field col-2 flex flex-column"},K=s("label",null,"Al",-1),W={key:1},X={class:"flex align-items-center flex-wrap"},Y={class:"col-4"},Z={key:0},oo={key:1},ao={class:"col-4"},eo={key:0},to={key:1},so={class:"col-4"},no={key:0},ro={key:1},lo={class:"flex align-items-start flex-wrap"},io={class:"field flex flex-column col-6 mt-4"},co={class:"col-8 field flex flex-column"},uo=s("label",{for:"location"},"Percorso",-1),mo={class:"field flex flex-column col-6 mt-4"},ho=s("h3",null,"Incassi per tipologia di pagamento",-1);function _o(o,e,m,u,p,D){const h=b("Calendar"),t=b("Card"),n=b("Dropdown"),a=b("DashboardTable"),r=b("DashboardPaymentsTable");return c(),_("div",E,[j,o.form?(c(),_("div",G,[s("div",Q,[z,l(h,{inputId:"date",modelValue:o.form.from,"onUpdate:modelValue":e[0]||(e[0]=d=>o.form.from=d),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),s("div",H,[K,l(h,{inputId:"date",modelValue:o.form.to,"onUpdate:modelValue":e[1]||(e[1]=d=>o.form.to=d),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])])):x("",!0),o.dashboards?(c(),_("div",W,[s("div",X,[s("div",Y,[l(t,null,{title:i(()=>[y(" Vendite ONLINE ")]),content:i(()=>[o.dashboards.total_online!==void 0&&o.dashboards.total_online!==null?(c(),_("span",Z," € "+v((+o.dashboards.total_online).toFixed(2)),1)):(c(),_("span",oo,"0"))]),_:1})]),s("div",ao,[l(t,null,{title:i(()=>[y(" Vendite IN LOCO ")]),content:i(()=>[o.dashboards.total_ticket_office!==void 0&&o.dashboards.total_ticket_office!==null?(c(),_("span",eo," € "+v((+o.dashboards.total_ticket_office).toFixed(2)),1)):(c(),_("span",to,"0"))]),_:1})]),s("div",so,[l(t,null,{title:i(()=>[y(" Vendite TOTALI ")]),content:i(()=>[o.dashboards.total?(c(),_("span",no," € "+v((+o.dashboards.total).toFixed(2)||"-"),1)):(c(),_("span",ro," 0 "))]),_:1})])]),s("div",lo,[s("div",io,[s("div",co,[uo,l(n,{modelValue:o.form.course_name,"onUpdate:modelValue":e[2]||(e[2]=d=>o.form.course_name=d),options:o.dashboardCourses.courses,optionLabel:"name",optionValue:"name",placeholder:"",name:"location"},null,8,["modelValue","options"])]),l(a,{course:o.form.course_name},null,8,["course"])]),s("div",mo,[ho,l(r)])])])):x("",!0)])}const yo=P(U,[["render",_o]]);export{yo as default};
