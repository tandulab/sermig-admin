import{D as k,c as w}from"./formatData29449.js";import{u as N,e as I}from"./helpers29449.js";import{x as A,A as L,d as g,c as p,r as _,b as i,m as x,w as c,f as d,g as r,t as v,h as D,o as F,l as $,a as O,i as C,_ as M,e as h,p as S}from"../index29449.js";import{u as P}from"./configuration29449.js";import{u as B}from"./order29449.js";class V{static async fetchAllReveliaDashboard(a){return(await A("/admin/dashboards",a)).data}static async fetchAllDashboard(a){return(await A("/admin/dashboard",a)).data}}const T=L({id:"dashboard",state:()=>({dashboard:{},dashboards:[],response_dashboards:{}}),getters:{allDashboards:o=>o.dashboard,responseDashboards:o=>o.response_dashboards,getCurrentDashboard:o=>o.dashboard},actions:{async fetchAllReveliaDashboard(o){await V.fetchAllReveliaDashboard(o).then(a=>{this.response_dashboards=a,this.dashboard=this.response_dashboards.dashboard})},async fetchAllDashboard(o){await V.fetchAllDashboard(o).then(a=>{this.dashboard=a})}}}),J={class:"pl-4"},q=g({__name:"DashboardTable",props:{course:{}},setup(o){const a=o,u=T(),m=p(()=>u.allDashboards),b=p(()=>{var l;if(!((l=m.value)!=null&&l.report)||!a.course)return[];const t=m.value.report[a.course];return!t||!t.tickets?[]:Object.entries(t.tickets).map(([s,e])=>({ticketType:s,quantity:e.total_tickets??0,amount:e.total_amount??0}))}),y=p(()=>{var l,s;const t=(s=(l=m.value)==null?void 0:l.report)==null?void 0:s[a.course];return t?Number(t.total_amount??0):0}),f=p(()=>{var l,s;const t=(s=(l=m.value)==null?void 0:l.report)==null?void 0:s[a.course];return t?Number(t.total_tickets??0):0});return(t,l)=>{const s=_("Column"),e=_("DataTable");return i(),x(e,{value:b.value,tableStyle:"min-width: 30rem"},{default:c(()=>[d(s,{field:"ticketType",header:"Tipologia Biglietto",footer:"Totale:",footerClass:"font-bold text-right"}),d(s,{field:"quantity",header:"Quantità",footer:"      "+f.value,footerClass:"font-bold"},{body:c(n=>[r("div",J,v(n.data.quantity),1)]),_:1},8,["footer"]),d(s,{field:"amount",header:"Importo",footer:`€ ${Number(y.value).toFixed(2)}`,footerClass:"font-bold"},{body:c(n=>[r("span",null,"€ "+v(Number(n.data.amount).toFixed(2)),1)]),_:1},8,["footer"])]),_:1},8,["value"])}}}),R=g({__name:"DashboardPaymentsTable",setup(o){const a=T(),u=B(),m=p(()=>a.allDashboards),b=p(()=>u.paymentModeList),y=p(()=>{var t;return((t=m.value)==null?void 0:t.payments)??[]});function f(t){var s;const l=(s=b.value)==null?void 0:s.find(e=>e.id===t);return l?l.label:t}return(t,l)=>{const s=_("Column"),e=_("DataTable");return i(),x(e,{value:y.value,tableStyle:"min-width: 20rem"},{default:c(()=>[d(s,{header:"Metodo di pagamento"},{body:c(n=>[D(v(f(n.data.method)),1)]),_:1}),d(s,{field:"amount",header:"Importo"},{body:c(n=>[r("span",null,"€ "+v(Number(n.data.amount).toFixed(2)),1)]),_:1})]),_:1},8,["value"])}}}),U=g({setup(){F(()=>{o.value.from=k.now().minus({months:1}).toJSDate(),o.value.to=k.now().toJSDate();const e=JSON.parse(localStorage.getItem("location")||"null");e&&e.id&&(l(e.id),s())});const o=$({}),a=T(),u=P(),{showLoader:m,hideLoader:b}=N(),y=O(),f=p(()=>a.allDashboards),t=p(()=>u.responseCourses),l=async function(e){const n=new Map;n.set("location_id",e),await u.getAllCourses(n)},s=async function(){m();const e=new Map;e.set("from",w(o.value.from)),e.set("to",w(o.value.to)),await a.fetchAllDashboard(e).then(()=>{b()}).catch(n=>{b(),I(y,n)})};return C(t,e=>{e.courses&&Array.isArray(e.courses)&&e.courses.length>0&&!o.value.course_name&&(o.value.course_name=e.courses[0].name)}),C(()=>o.value.from,()=>{s()}),C(()=>o.value.to,()=>{s()}),{form:o,dashboards:f,responseCourses:t,fetchAllDashboard:s}},components:{DashboardTable:q,DashboardPaymentsTable:R}});const E={class:"dashboard"},j=r("h1",null,"Dashboard",-1),G={key:0,class:"flex align-items-center"},Q={class:"field col-2 flex flex-column"},z=r("label",null,"Dal",-1),H={class:"field col-2 flex flex-column"},K=r("label",null,"Al",-1),W={key:1},X={class:"flex align-items-center flex-wrap"},Y={class:"col-4"},Z={key:0},oo={key:1},eo={class:"col-4"},ao={key:0},to={key:1},so={class:"col-4"},no={key:0},ro={key:1},lo={class:"flex align-items-start flex-wrap"},co={class:"field flex flex-column col-6 mt-4"},io={class:"col-8 field flex flex-column"},uo=r("label",{for:"location"},"Percorso",-1),mo={class:"field flex flex-column col-6 mt-4"},ho=r("h3",null," Incassi per tipologia di pagamento ",-1);function _o(o,a,u,m,b,y){const f=_("Calendar"),t=_("Card"),l=_("Dropdown"),s=_("DashboardTable"),e=_("DashboardPaymentsTable");return i(),h("div",E,[j,o.form?(i(),h("div",G,[r("div",Q,[z,d(f,{inputId:"date",modelValue:o.form.from,"onUpdate:modelValue":a[0]||(a[0]=n=>o.form.from=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])]),r("div",H,[K,d(f,{inputId:"date",modelValue:o.form.to,"onUpdate:modelValue":a[1]||(a[1]=n=>o.form.to=n),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:""},null,8,["modelValue"])])])):S("",!0),o.dashboards?(i(),h("div",W,[r("div",X,[r("div",Y,[d(t,null,{title:c(()=>[D(" Vendite ONLINE ")]),content:c(()=>[o.dashboards.total_online!==void 0&&o.dashboards.total_online!==null?(i(),h("span",Z," € "+v((+o.dashboards.total_online).toFixed(2)),1)):(i(),h("span",oo,"0"))]),_:1})]),r("div",eo,[d(t,null,{title:c(()=>[D(" Vendite IN LOCO ")]),content:c(()=>[o.dashboards.total_ticket_office!==void 0&&o.dashboards.total_ticket_office!==null?(i(),h("span",ao," € "+v((+o.dashboards.total_ticket_office).toFixed(2)),1)):(i(),h("span",to,"0"))]),_:1})]),r("div",so,[d(t,null,{title:c(()=>[D(" Vendite TOTALI ")]),content:c(()=>[o.dashboards.total?(i(),h("span",no," € "+v((+o.dashboards.total).toFixed(2)||"-"),1)):(i(),h("span",ro," 0 "))]),_:1})])]),r("div",lo,[r("div",co,[r("div",io,[uo,d(l,{modelValue:o.form.course_name,"onUpdate:modelValue":a[2]||(a[2]=n=>o.form.course_name=n),options:o.responseCourses.courses,optionLabel:"name",optionValue:"name",placeholder:"",name:"location"},null,8,["modelValue","options"])]),d(s,{course:o.form.course_name},null,8,["course"])]),r("div",mo,[ho,d(e)])])])):S("",!0)])}const Do=M(U,[["render",_o]]);export{Do as default};
